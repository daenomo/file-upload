<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ファイルアップロードのデモ</title>
</head>
<body>

<h2>メディアプレーヤー</h2>
<video id="videoPlayer" width="600" controls>
    <source id="videoSource" src="" type="video/mp4">
    お使いのブラウザはこのビデオタグをサポートしていません。
</video>
<img id="imageDisplay" src="" style="display:none;" width="600"/>

<h2>ファイルアップロードフォーム</h2>
<form enctype="multipart/form-data" action="/upload" method="POST">
    <input type="file" name="file" multiple>
    <input type="submit" value="アップロード">
</form>

<ul id="fileList">
    {{range .}}
    <li>
        <a href="#" onclick="playFile('{{.Name}}'); return false;">{{.Name}}</a>
    </li>
    {{else}}
    <p>No files found.</p>
    {{end}}
</ul>

<script>
    const videoPlayer = document.getElementById('videoPlayer');
    const videoSource = document.getElementById('videoSource');
    const imageDisplay = document.getElementById('imageDisplay');
    const fileList = document.getElementById('fileList').getElementsByTagName('a');
    let currentFileName = "";
    let fileChangeTimeout;

    function playFile(fileName) {
        clearTimeout(fileChangeTimeout);
        currentFileName = fileName;
        const extension = fileName.split('.').pop().toLowerCase();
        const src = `/videos/${fileName}`;

        if (extension === 'mp4') {
            videoPlayer.style.display = 'block';
            imageDisplay.style.display = 'none';
            videoSource.src = src;
            videoPlayer.load();
            videoPlayer.play();
            videoPlayer.addEventListener('ended', playNextFile);
        } else if (extension === 'jpg' || extension === 'jpeg' || extension === 'png') {
            videoPlayer.style.display = 'none';
            imageDisplay.style.display = 'block';
            imageDisplay.src = src;
            fileChangeTimeout = setTimeout(playNextFile, 10000);  // 10秒後に次のファイルを再生
        }
    }

    function playNextFile() {
        let currentIndex = Array.from(fileList).findIndex(a => a.textContent === currentFileName);
        currentIndex++;
        if (currentIndex < fileList.length) {
            playFile(fileList[currentIndex].textContent);
        } else {
            currentIndex = 0;
            playFile(fileList[currentIndex].textContent);
        }
    }

    document.getElementById('startPlayback').addEventListener('click', function() {
        if (fileList.length > 0) {
            playFile(fileList[0].textContent);
            this.style.display = 'none';
        }
    });

    const startPlaybackButton = document.createElement('button');
    startPlaybackButton.id = 'startPlayback';
    startPlaybackButton.textContent = '最初のファイルを再生';
    document.body.appendChild(startPlaybackButton);
</script>

</body>
</html>
